# Broken Authentication

## What is Authentication

authentication is the act of proving an assertion  
in this module which is more app security focused, authentication could be described as determining if an entity is who it claims to be 

most widespread form of authentication used in web apps is a login form   
usually the first line of defense against unauthorized access 

keep in mind this is not authorization which is the process of approving or disapproving a request from a given, authenticated, entity   

most companies offer certain services for which their customers have to register and authenticate  
our goal is to verify if these login forms are implemented securely and if we can bypass them to gain unauthorized access   

## Overview of Authentication Methods 

during the authentication phase the entity who wants to auth sends an `identification string` which could be an ID, username, email, etc.   
the most common type of data that an auth process requires to be sent with the identification string is a password   
however, the type of additional data can vary in type 

### Multi-factor authentication 

MFA or 2FA can result in a much more robust authentication process   

3 domains of factors: 
- something you know 
- something you have 
- something you are 

### Form-based authentication 

most common authentication methods for web apps is form-based authentication   
app presents an HTML form where user inputs username and password; access granted after comparing the received data against a backend 

after successful login the app server creates a session tied to a unique key (usually stored in a cookie)   
key is passed between the client and the web app on every subsequent communication for the session to be maintained 

some require multiple steps of authentication like also using a one-time password OTP   
these can originate from a hardware device or app   
usually only last for a limited amount of time and are valid for only one login attempt   

some multi-step procedures suffer from `business logic` vulnerabilities like step 3 might take for granted that step 1 and 2 have been completed successfully 

### HTTP based authentication 

app server can specify different auth schemes such as basic, digest, and NTLM   
all schemes revolve around the `401` status code and the `WWW-Authenticate` response header   
used by app servers to challenge a client request and provide authentication details (challenge-response process)

when using http-based auth the `authorization header` also holds the authentication data and should be present in every request for the user to be authenticated 

from a network pov this can be less secure that FBA because every request contains authentication data   
for example, the browser encodes the username and password using base64; the authorization header will contain the base64 encoded credentials in every request  
therefore, an attacker that can capture the traffic in plaintext will also capture credentials   
the same would happen in FBA but just not for every request 

an example header that a browser sends for basic authentication would look like: 

```shell-session
GET /basic_auth.php HTTP/1.1
Host: brokenauth.hackthebox.eu
Cache-Control: max-age=0
Authorization: Basic YWRtaW46czNjdXIzcDQ1NQ==
```

it specifies the authentication method, like Basic, and the token which can be decoded to `admin:s3cur3p455`

digest and NTLM are more robust because they use hashed data and could contain a nonce, but these can still be cracked and might also be vulnerable to reusing a captured token 

### Other forms of authentication

uncommon but also possible that authentication is performed by checking the source IP address  
a request from localhost or trusted IP could be allowed because developers assumed nobody would use them 

modern apps can also use third parties to authenticate users like `SAML` and APIs usually require a authentication form which are often multi-step 

attacks against API authentication/authorization, SSO, and OAuth have the same foundations as attacks against classic web apps 

### Login example 

a typical scenario for home banking authentication: 
- requests our ID which could be seven-digit number generated by app or a username 
- app requests a password for the given ID 
- user must provide an OTP 
- app checks if the ID, password, and OTP are valid 

## Overview of Attacks Against Authentication 

auth attacks can take place against the three domains: 
- has
- is
- knows

### Attacking the HAS domain 

this can seem simple because it looks like it comes down to if we have the hardware token or not  
things can be more complicated though: 
- a badge could be cloned without taking it over
- a crypto algorithm used to generate OTP could be broken
- a physical device could be stolen 

a long-range antenna can easily cover a distance of 50cm and clone a classic NFC badge   
there are also many other social-engineering based methods to clone a card 

### Attacking the IS domain 

this may seem as the most difficult to attack  
if something relies on something to prove their identity and that something gets compromised, then they lose that method because there is no way to change that part of them   

retina, fingerprint, and facial recognition have all been proved to be breakable   
these can be broken through third-party leak, high-definition picture, a skimmer or even someone who might steal the right glass you drank from 

companies that sell biometric smart locks have been breached to release all of its users fingerprints and facial patterns 

### Attacking the knows domain 

we will deal with this in this module  

things that the user knows like a username and password in methods like FBA 

## Default Credentials 

it is common to find devices with default credentials due to human error or a breakdown in or lack of proper process  

Rapid7's under the hoodie report said that known default credentials resulting in unauthorized access were 21% of their engagements 

systems like ICS environments even prefer known credentials because it makes it easier than storing a complex set of credentials securely   
this however does not justify default credentials 

it is a mandatory step of security hardening to change default passwords at an early stage of app development 

another common thing is vendors use hardcoded hidden accounts in their products   
https://nvd.nist.gov/vuln/detail/CVE-2020-29583 - researchers found a hardcoded account with admin privileges and an unchangeable password 

CIRT.net and SecLists have databases used to collect default credentials split by vendors   

https://github.com/scadastrangelove/SCADAPASS/blob/master/scadapass.csv - SCADA StrangeLove published list of well-known ICS passwords, both default and hardcoded 

always good to test known passwords against systems with lists like these, for example if you found a Cisco device then you could use https://www.cirt.net/passwords?criteria=cisco

### Hands-on example 

